<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>Three.js + AR.js Example</title>
	<script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/ar.js@3.3.2/build/ar.js"></script>
	<script src="./threeX/artoolkit.api.js"></script>
	<script src="./threeX/artoolkit.min.js"></script>
	<script src="./threeX/threex-arbasecontrols.js"></script>
	<script src="./threeX/threex-armarkercontrols.js"></script>
	<script src="./threeX/threex-artoolkitcontext.js"></script>
	<script src="./threeX/threex-artoolkitsource.js"></script>
	<script src="./Surface.js"></script>
</head>

<body style="margin:0; overflow:hidden;">
	<div id="ar-container"></div>
	<script>
		var scene = new THREE.Scene();
		var camera = new THREE.Camera();
		scene.add(camera);

		var renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
		renderer.setSize(window.innerWidth, window.innerHeight);
		document.getElementById('ar-container').appendChild(renderer.domElement);

		var arSource = new THREEx.ArToolkitSource({ sourceType: 'webcam' });
		arSource.init(function onReady() { onResize() });
		window.addEventListener('resize', function () { onResize() });
		function onResize() {
			arSource.onResizeElement();
			arSource.copyElementSizeTo(renderer.domElement);
			if (arContext.arController !== null) {
				arSource.copyElementSizeTo(arContext.arController.canvas);
			}
		}

		var arContext = new THREEx.ArToolkitContext({
			cameraParametersUrl: 'https://cdn.jsdelivr.net/npm/ar.js@4.2.0/data/data/camera_para.dat',
			detectionMode: 'mono'
		});
		arContext.init(function onCompleted() {
			camera.projectionMatrix.copy(arContext.getProjectionMatrix());
		});

		var markerRoot = new THREE.Group();
		scene.add(markerRoot);
		var markerControls = new THREEx.ArMarkerControls(arContext, markerRoot, {
			type: 'pattern',
			patternUrl: 'https://cdn.jsdelivr.net/npm/ar.js@4.2.0/data/data/patt.hiro'
		});

		var surface = new SurfaceThreeJS('MySurface', 2, 1, 50, 50);
		var mesh = surface.createMesh();
		markerRoot.add(mesh);

		function animate() {
			requestAnimationFrame(animate);
			if (arSource.ready) arContext.update(arSource.domElement);
			renderer.render(scene, camera);
		}
		animate();
	</script>
</body>

</html>